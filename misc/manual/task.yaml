version: "3"

includes:
  os: ./task_{{OS}}.yaml

tasks:
  prompt_value:
    requires:
      vars: [INSTRUCTIONS, OUTPUT_FILE]
    vars:
      OUTPUT_APPEND: '{{default "false" .OUTPUT_APPEND}}'
      OUTPUT_TEMPLATE: '{{default "$SECRET" .OUTPUT_TEMPLATE}}'
    cmds:
      - task: os:prompt_value
        vars:
          IS_SECRET: "{{.IS_SECRET}}"
          INSTRUCTIONS: "{{.INSTRUCTIONS}}"
          OUTPUT_FILE: "{{.OUTPUT_FILE}}"
          OUTPUT_APPEND: "{{.OUTPUT_APPEND}}"
          OUTPUT_TEMPLATE: "{{.OUTPUT_TEMPLATE}}"

  prompt_secret:
    requires:
      vars: [INSTRUCTIONS, OUTPUT_FILE]
    vars:
      OUTPUT_APPEND: '{{default "false" .OUTPUT_APPEND}}'
      OUTPUT_TEMPLATE: '{{default "$SECRET" .OUTPUT_TEMPLATE}}'
    cmds:
      - task: prompt_value
        vars:
          IS_SECRET: true
          INSTRUCTIONS: "{{.INSTRUCTIONS}}"
          OUTPUT_FILE: "{{.OUTPUT_FILE}}"
          OUTPUT_APPEND: "{{.OUTPUT_APPEND}}"
          OUTPUT_TEMPLATE: "{{.OUTPUT_TEMPLATE}}"
